# Programa Equil√≠brio - Belz Conecta Sa√∫de

Sistema de Diagn√≥stico Corporativo de Sa√∫de Mental e Ergonomia

## üìã Sobre o Projeto

O **Programa Equil√≠brio** √© uma aplica√ß√£o web desenvolvida para a **Belz Conecta Sa√∫de** que oferece um diagn√≥stico corporativo completo focado em duas √°reas principais:

- üß† **Sa√∫de Mental**: Avalia√ß√£o de fatores de estresse, burnout e bem-estar psicol√≥gico
- üîß **Ergonomia**: An√°lise do ambiente de trabalho e preven√ß√£o de les√µes ocupacionais

## üöÄ Funcionalidades

### ‚ú® Principais Recursos

- **Formul√°rio de Dados da Empresa**: Coleta informa√ß√µes b√°sicas da organiza√ß√£o
- **Question√°rio Interativo**: 10 perguntas estrat√©gicas sobre sa√∫de mental e ergonomia
- **An√°lise Inteligente**: Processamento autom√°tico das respostas com recomenda√ß√µes
- **Relat√≥rio Completo**: Visualiza√ß√£o detalhada dos resultados
- **Export em PDF**: Download do diagn√≥stico completo com logo e bordas arredondadas
- **Interface Responsiva**: Funciona em desktop, tablet e mobile
- **Design Moderno**: Interface com emojis informativos e visual profissional

### üìä Estrutura do Question√°rio

1. **üß† Fatores de estresse** - Identifica√ß√£o das principais fontes de estresse
2. **üìä Afastamentos por transtornos mentais** - Hist√≥rico de problemas de sa√∫de mental
3. **üò¥ Sinais de esgotamento** - Detec√ß√£o precoce de burnout
4. **üé≠ A√ß√µes de sa√∫de mental realizadas** - Mapeamento de iniciativas existentes
5. **üè¢ Perfil da atividade** - Tipo de ambiente de trabalho
6. **ü¶¥ Queixas de dores f√≠sicas** - Identifica√ß√£o de problemas ergon√¥micos
7. **üîç Avalia√ß√£o ergon√¥mica** - Hist√≥rico de diagn√≥sticos t√©cnicos
8. **üèÉ A√ß√µes preventivas em ergonomia** - Iniciativas ergon√¥micas implementadas
9. **üéØ Prioridade do RH** - N√≠vel de import√¢ncia estrat√©gica
10. **ü§ù Necessidade de apoio externo** - Abertura para parcerias

## üõ†Ô∏è Tecnologias Utilizadas

- **Backend**: Python 3.13 + Flask 2.3.3
- **Frontend**: HTML5, CSS3, JavaScript, Bootstrap 5.1.3
- **PDF**: ReportLab 4.0.4 + Pillow (para imagens)
- **√çcones**: Font Awesome 6.0.0
- **Responsividade**: Bootstrap Grid System

## üì¶ Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos

- Python 3.8 ou superior
- pip (gerenciador de pacotes Python)
- Git (para clone do reposit√≥rio)

### Desenvolvimento Local

1. **Clone ou baixe o projeto**
   ```bash
   git clone [url-do-repositorio]
   cd programaequilibrio
   ```

2. **Crie um ambiente virtual**
   ```bash
   python -m venv .venv
   ```

3. **Ative o ambiente virtual**
   ```bash
   # Windows
   .venv\Scripts\activate
   
   # Linux/Mac
   source .venv/bin/activate
   ```

4. **Instale as depend√™ncias**
   ```bash
   pip install -r requirements.txt
   ```

5. **Execute a aplica√ß√£o**
   ```bash
   python main.py
   ```

6. **Acesse o sistema**
   - Abra seu navegador
   - V√° para: `http://localhost:5000`

## üöÄ Deploy em Produ√ß√£o

### üìã requirements.txt

Certifique-se de que o arquivo `requirements.txt` cont√©m:

```txt
Flask==2.3.3
reportlab==4.0.4
Pillow==10.0.1
gunicorn==21.2.0
```

### üñ•Ô∏è Deploy em Servidor Linux (Ubuntu/Debian)

#### 1. Preparar o Servidor

```bash
# Atualizar sistema
sudo apt update && sudo apt upgrade -y

# Instalar Python e depend√™ncias
sudo apt install python3 python3-pip python3-venv nginx -y

# Instalar supervisor para gerenciar processos
sudo apt install supervisor -y
```

#### 2. Configurar o Projeto

```bash
# Ir para diret√≥rio de projetos
cd /var/www/

# Clonar projeto
sudo git clone [url-do-repositorio] programaequilibrio
sudo chown -R www-data:www-data programaequilibrio
cd programaequilibrio

# Criar ambiente virtual
sudo -u www-data python3 -m venv .venv
sudo -u www-data .venv/bin/pip install -r requirements.txt
```

#### 3. Configurar Gunicorn

Criar arquivo `/var/www/programaequilibrio/gunicorn.conf.py`:

```python
bind = "127.0.0.1:5000"
workers = 2
worker_class = "sync"
worker_connections = 1000
max_requests = 1000
max_requests_jitter = 100
timeout = 30
keepalive = 2
user = "www-data"
group = "www-data"
tmp_upload_dir = None
```

#### 4. Configurar Supervisor

Criar arquivo `/etc/supervisor/conf.d/programaequilibrio.conf`:

```ini
[program:programaequilibrio]
command=/var/www/programaequilibrio/.venv/bin/gunicorn -c gunicorn.conf.py main:app
directory=/var/www/programaequilibrio
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/programaequilibrio.log
```

#### 5. Configurar Nginx

Criar arquivo `/etc/nginx/sites-available/programaequilibrio`:

```nginx
server {
    listen 80;
    server_name seu-dominio.com;  # Substitua pelo seu dom√≠nio
    
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        client_max_body_size 50M;
    }
    
    location /static/ {
        alias /var/www/programaequilibrio/static/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 6. Ativar Configura√ß√µes

```bash
# Ativar site no Nginx
sudo ln -s /etc/nginx/sites-available/programaequilibrio /etc/nginx/sites-enabled/

# Testar configura√ß√£o Nginx
sudo nginx -t

# Recarregar Supervisor e Nginx
sudo supervisorctl reread
sudo supervisorctl update
sudo systemctl restart nginx
```

### üîí Configurar HTTPS com Let's Encrypt

```bash
# Instalar Certbot
sudo apt install certbot python3-certbot-nginx -y

# Obter certificado SSL
sudo certbot --nginx -d seu-dominio.com

# Renova√ß√£o autom√°tica
sudo crontab -e
# Adicionar linha:
0 3 * * * certbot renew --quiet
```

### ‚òÅÔ∏è Deploy na AWS EC2

#### 1. Criar Inst√¢ncia EC2

- Escolha Ubuntu 20.04 LTS ou superior
- Tipo: t2.micro (para testes) ou t2.small (produ√ß√£o)
- Configure Security Group:
  - HTTP (80)
  - HTTPS (443)
  - SSH (22)

#### 2. Conectar e Configurar

```bash
# Conectar via SSH
ssh -i sua-chave.pem ubuntu@ip-da-instancia

# Seguir passos de "Deploy em Servidor Linux" acima
```

#### 3. Configurar Elastic IP (Opcional)

- No Console AWS, v√° em EC2 > Elastic IPs
- Aloque um IP est√°tico
- Associe √† sua inst√¢ncia

### üêã Deploy com Docker

#### 1. Criar Dockerfile

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# Instalar depend√™ncias do sistema
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Copiar requirements e instalar
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copiar c√≥digo
COPY . .

# Criar usu√°rio n√£o-root
RUN useradd -m -u 1000 appuser && chown -R appuser:appuser /app
USER appuser

EXPOSE 5000

CMD ["gunicorn", "-b", "0.0.0.0:5000", "--workers", "2", "main:app"]
```

#### 2. Criar docker-compose.yml

```yaml
version: '3.8'
services:
  web:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - ./static:/app/static:ro
    environment:
      - FLASK_ENV=production
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./static:/var/www/static:ro
    depends_on:
      - web
    restart: unless-stopped
```

#### 3. Executar

```bash
# Build e executar
docker-compose up -d

# Ver logs
docker-compose logs -f

# Parar
docker-compose down
```

### ‚ö° Deploy na Vercel (Recomendado)

A Vercel oferece deploy simples e gratuito para aplica√ß√µes Flask.

#### **1. Preparar o Projeto**

Os seguintes arquivos j√° est√£o configurados:
- ‚úÖ `vercel.json` - Configura√ß√£o da Vercel
- ‚úÖ `requirements.txt` - Depend√™ncias otimizadas
- ‚úÖ `main.py` - Configurado para produ√ß√£o

#### **2. Deploy via CLI**

```bash
# Instalar Vercel CLI
npm i -g vercel

# Fazer login
vercel login

# Deploy
vercel

# Deploy em produ√ß√£o
vercel --prod
```

#### **3. Deploy via GitHub (Mais F√°cil)**

1. **Criar Reposit√≥rio no GitHub**:
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/SEU-USUARIO/programa-equilibrio.git
   git push -u origin main
   ```

2. **Conectar √† Vercel**:
   - Acesse https://vercel.com
   - Clique em "New Project"
   - Conecte com GitHub
   - Selecione seu reposit√≥rio
   - Configure:
     - Framework: **Other**
     - Root Directory: **/** (raiz)
     - Build Command: **(deixe vazio)**
     - Output Directory: **(deixe vazio)**
   - Clique em "Deploy"

3. **Deploy Autom√°tico**:
   - Cada push no GitHub far√° deploy autom√°tico
   - URL ser√° fornecida automaticamente

#### **4. Vari√°veis de Ambiente (se necess√°rio)**

No dashboard da Vercel:
- Settings ‚Üí Environment Variables
- Adicione se precisar:
  ```
  FLASK_ENV=production
  DEBUG=False
  ```

### üìä Monitoramento em Produ√ß√£o

#### 1. Logs do Sistema

```bash
# Ver logs Supervisor
sudo tail -f /var/log/supervisor/programaequilibrio.log

# Ver logs Nginx
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

#### 2. Monitoramento de Performance

```bash
# CPU e Mem√≥ria
htop

# Conex√µes de rede
netstat -tulpn | grep :5000

# Espa√ßo em disco
df -h
```

### üîß Configura√ß√µes de Produ√ß√£o

#### 1. Vari√°veis de Ambiente

Criar arquivo `.env`:

```env
FLASK_ENV=production
SECRET_KEY=sua-chave-secreta-super-segura
DEBUG=False
```

#### 2. Modificar main.py para produ√ß√£o

```python
import os
from dotenv import load_dotenv

load_dotenv()

if __name__ == '__main__':
    debug_mode = os.getenv('DEBUG', 'False').lower() == 'true'
    port = int(os.getenv('PORT', 5000))
    
    app.run(
        debug=debug_mode,
        host='0.0.0.0',
        port=port
    )
```

### üõ°Ô∏è Seguran√ßa em Produ√ß√£o

#### 1. Firewall

```bash
# Configurar UFW
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'
sudo ufw enable
```

#### 2. Backup Automatizado

```bash
# Criar script de backup
sudo nano /usr/local/bin/backup-programaequilibrio.sh
```

```bash
#!/bin/bash
BACKUP_DIR="/var/backups/programaequilibrio"
DATE=$(date +"%Y%m%d_%H%M%S")

mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/backup_$DATE.tar.gz /var/www/programaequilibrio

# Manter apenas √∫ltimos 7 backups
find $BACKUP_DIR -name "backup_*.tar.gz" -mtime +7 -delete
```

```bash
# Tornar execut√°vel
sudo chmod +x /usr/local/bin/backup-programaequilibrio.sh

# Agendar no cron (backup di√°rio)
sudo crontab -e
# Adicionar:
0 2 * * * /usr/local/bin/backup-programaequilibrio.sh
```

## üìÅ Estrutura do Projeto

```
programaequilibrio/
‚îú‚îÄ‚îÄ main.py                 # Aplica√ß√£o principal Flask
‚îú‚îÄ‚îÄ requirements.txt        # Depend√™ncias Python
‚îú‚îÄ‚îÄ README.md              # Documenta√ß√£o
‚îú‚îÄ‚îÄ temp_diagnostico.json  # Dados tempor√°rios (criado automaticamente)
‚îú‚îÄ‚îÄ templates/             # Templates HTML
‚îÇ   ‚îú‚îÄ‚îÄ base.html         # Template base
‚îÇ   ‚îú‚îÄ‚îÄ index.html        # P√°gina inicial
‚îÇ   ‚îú‚îÄ‚îÄ questionario.html # Formul√°rio de perguntas
‚îÇ   ‚îî‚îÄ‚îÄ resultado.html    # P√°gina de resultados
‚îî‚îÄ‚îÄ static/               # Arquivos est√°ticos
    ‚îú‚îÄ‚îÄ css/
    ‚îÇ   ‚îî‚îÄ‚îÄ style.css     # Estilos customizados
    ‚îî‚îÄ‚îÄ js/
        ‚îî‚îÄ‚îÄ main.js       # JavaScript principal
```

## üéØ Como Usar

### 1. P√°gina Inicial
- Preencha os dados da empresa (Raz√£o Social, CNPJ, RH Respons√°vel, etc.)
- Clique em "Iniciar Diagn√≥stico"

### 2. Question√°rio
- Responda as 10 perguntas do diagn√≥stico
- Use os bot√µes "Anterior" e "Pr√≥xima" para navegar
- Acompanhe o progresso na barra superior
- Clique em "Finalizar Diagn√≥stico" na √∫ltima pergunta

### 3. Resultado
- Visualize o resumo do diagn√≥stico
- Veja as recomenda√ß√µes de a√ß√µes prim√°rias
- Confira o plano de a√ß√£o sugerido
- Exporte o relat√≥rio completo em PDF

## üìä Sistema de An√°lise

O sistema analisa as respostas e gera automaticamente:

### M√©tricas Calculadas
- **Quest√µes Cr√≠ticas**: N√∫mero de √°reas que precisam de aten√ß√£o imediata
- **A√ß√µes Recomendadas**: Programas espec√≠ficos sugeridos
- **Horas de Treinamento**: Estimativa de tempo necess√°rio

### Recomenda√ß√µes Autom√°ticas

**üß† Sa√∫de Mental**
- **Programa**: Comunica√ß√£o N√£o Violenta e Seguran√ßa Psicol√≥gica
- **Dura√ß√£o**: 5 horas
- **P√∫blico**: Todos os colaboradores + Lideran√ßas

**üîß Ergonomia**
- **Consultoria**: Avalia√ß√£o Ergon√¥mica Completa
- **Dura√ß√£o**: 16 horas
- **P√∫blico**: RH + Lideran√ßas + SESMT

### Plano de A√ß√£o Temporizado
- **üö® Imediatas (30 dias)**: A√ß√µes cr√≠ticas de sa√∫de mental
- **‚ö†Ô∏è M√©dio Prazo (60 dias)**: Avalia√ß√µes ergon√¥micas
- **üìä Cont√≠nuas (90+ dias)**: Monitoramento e indicadores

## üé® Personaliza√ß√£o

### Cores e Marca
As cores principais podem ser alteradas no arquivo `static/css/style.css`:

```css
:root {
    --primary-color: #2B5AA0;  /* Azul Belz */
    --secondary-color: #E8F4FD; /* Azul claro */
    --success-color: #28a745;   /* Verde */
    --warning-color: #ffc107;   /* Amarelo */
    --danger-color: #dc3545;    /* Vermelho */
}
```

### Perguntas do Question√°rio
As perguntas podem ser modificadas no arquivo `main.py` na vari√°vel `PERGUNTAS`.

## üîß Configura√ß√µes Avan√ßadas

### Modo Debug
Para desenvolvimento, o debug est√° habilitado por padr√£o. Para produ√ß√£o, altere:

```python
app.run(debug=False, host='0.0.0.0', port=5000)
```

### Porta Personalizada
Para usar uma porta diferente:

```python
app.run(debug=True, host='0.0.0.0', port=8080)  # Porta 8080
```

### SSL/HTTPS
Para usar HTTPS em produ√ß√£o, adicione os certificados:

```python
app.run(host='0.0.0.0', port=443, ssl_context='adhoc')
```

## üìÑ Gera√ß√£o de PDF

O sistema gera automaticamente um relat√≥rio PDF com:

- ‚úÖ Dados da empresa
- ‚úÖ Resumo visual com gr√°ficos
- ‚úÖ Recomenda√ß√µes detalhadas
- ‚úÖ Plano de a√ß√£o temporal
- ‚úÖ Branding da Belz Conecta Sa√∫de

## üêõ Solu√ß√£o de Problemas

### Erro: Porta j√° em uso
```bash
# Windows - mate o processo na porta 5000
netstat -ano | findstr :5000
taskkill /PID [PID_NUMBER] /F

# Linux/Mac
sudo lsof -t -i tcp:5000 | xargs kill -9
```

### Erro: M√≥dulo n√£o encontrado
```bash
# Reinstale as depend√™ncias
pip install --upgrade -r requirements.txt
```

### Erro: Permiss√£o negada
```bash
# Execute como administrador (Windows)
# Ou use sudo (Linux/Mac)
```

### ÔøΩ Checklist de Deploy

#### ‚úÖ Antes do Deploy

- [ ] Testar aplica√ß√£o localmente
- [ ] Verificar todas as depend√™ncias no `requirements.txt`
- [ ] Configurar vari√°veis de ambiente (`.env`)
- [ ] Testar gera√ß√£o de PDF
- [ ] Verificar se logo est√° no diret√≥rio `static/images/`
- [ ] Criar backup dos dados (se aplic√°vel)
- [ ] Documentar credenciais de acesso

#### ‚úÖ Durante o Deploy

- [ ] Configurar servidor/plataforma
- [ ] Instalar depend√™ncias
- [ ] Configurar proxy reverso (Nginx)
- [ ] Configurar SSL/HTTPS
- [ ] Testar conectividade
- [ ] Configurar monitoramento
- [ ] Configurar backups autom√°ticos

#### ‚úÖ Ap√≥s o Deploy

- [ ] Testar todas as funcionalidades
- [ ] Verificar logs de erro
- [ ] Configurar alertas
- [ ] Documentar URLs de produ√ß√£o
- [ ] Treinar usu√°rios finais
- [ ] Criar procedimentos de manuten√ß√£o

### üéØ URLs Importantes (Produ√ß√£o)

Depois do deploy, as seguintes URLs estar√£o dispon√≠veis:

- **Principal**: `https://seu-dominio.com/`
- **Question√°rio**: `https://seu-dominio.com/questionario`  
- **Health Check**: `https://seu-dominio.com/health`
- **Arquivos Est√°ticos**: `https://seu-dominio.com/static/`

### üÜò Troubleshooting

#### Problemas Comuns

1. **Erro 502 Bad Gateway**
   ```bash
   # Verificar se Gunicorn est√° rodando
   sudo supervisorctl status programaequilibrio
   
   # Reiniciar se necess√°rio
   sudo supervisorctl restart programaequilibrio
   ```

2. **PDF n√£o gera / Logo n√£o aparece**
   ```bash
   # Verificar permiss√µes do diret√≥rio static
   ls -la static/images/logo-conecta.png
   
   # Corrigir permiss√µes se necess√°rio
   sudo chown www-data:www-data static/images/logo-conecta.png
   ```

3. **Porta j√° em uso**
   ```bash
   # Linux: encontrar processo na porta
   sudo lsof -t -i tcp:5000 | xargs kill -9
   
   # Windows: matar processo na porta
   netstat -ano | findstr :5000
   taskkill /PID [PID_NUMBER] /F
   ```

4. **Erro de importa√ß√£o PIL/Pillow**
   ```bash
   # Instalar depend√™ncias de sistema (Ubuntu/Debian)
   sudo apt install libjpeg-dev zlib1g-dev libfreetype6-dev
   
   # Reinstalar Pillow
   pip uninstall Pillow
   pip install Pillow
   ```

### üì± Contato para Suporte

- **Desenvolvedor**: GitHub Copilot
- **Empresa**: Belz Conecta Sa√∫de  
- **Sistema**: Programa Equil√≠brio v1.0
- **Data**: Agosto 2025

---

## üìÇ Arquivos de Deploy Inclu√≠dos

Este reposit√≥rio j√° inclui todos os arquivos necess√°rios para deploy:

- `requirements.txt` - Depend√™ncias Python
- `Procfile` - Configura√ß√£o Heroku
- `runtime.txt` - Vers√£o Python para Heroku  
- `Dockerfile` - Configura√ß√£o Docker
- `docker-compose.yml` - Orquestra√ß√£o de containers
- `nginx.conf` - Configura√ß√£o Nginx
- `.env.example` - Exemplo de vari√°veis de ambiente

## üìä Estrutura Final do Projeto

```
programaequilibrio/
‚îú‚îÄ‚îÄ main.py                    # Aplica√ß√£o Flask principal
‚îú‚îÄ‚îÄ requirements.txt           # Depend√™ncias Python
‚îú‚îÄ‚îÄ Procfile                  # Config Heroku
‚îú‚îÄ‚îÄ runtime.txt               # Vers√£o Python
‚îú‚îÄ‚îÄ Dockerfile               # Config Docker
‚îú‚îÄ‚îÄ docker-compose.yml       # Orquestra√ß√£o
‚îú‚îÄ‚îÄ nginx.conf              # Config Nginx
‚îú‚îÄ‚îÄ .env.example            # Vari√°veis exemplo
‚îú‚îÄ‚îÄ README.md               # Esta documenta√ß√£o
‚îú‚îÄ‚îÄ temp_diagnostico.json   # Cache tempor√°rio
‚îú‚îÄ‚îÄ templates/              # Templates HTML
‚îÇ   ‚îú‚îÄ‚îÄ base.html
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ questionario.html
‚îÇ   ‚îî‚îÄ‚îÄ resultado.html
‚îî‚îÄ‚îÄ static/                 # Arquivos est√°ticos
    ‚îú‚îÄ‚îÄ css/
    ‚îÇ   ‚îî‚îÄ‚îÄ style.css
    ‚îú‚îÄ‚îÄ js/
    ‚îÇ   ‚îî‚îÄ‚îÄ main.js
    ‚îî‚îÄ‚îÄ images/
        ‚îî‚îÄ‚îÄ logo-conecta.png
```

## üìà Pr√≥ximas Funcionalidades

- [ ] Dashboard administrativo
- [ ] Hist√≥rico de diagn√≥sticos
- [ ] Comparativo temporal
- [ ] API para integra√ß√£o
- [ ] App mobile
- [ ] Relat√≥rios gerenciais
- [ ] Sistema de notifica√ß√µes
- [ ] Multi-idiomas

## üìÑ Licen√ßa

¬© 2025 Belz Conecta Sa√∫de - Todos os direitos reservados.

---

**Desenvolvido com ‚ù§Ô∏è para a Belz Conecta Sa√∫de**
